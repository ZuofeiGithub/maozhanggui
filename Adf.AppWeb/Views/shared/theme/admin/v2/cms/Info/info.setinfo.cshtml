@using Adf.FrameWork.Service.HtmlHelperEx
@using Adf.FrameWork.Service.LayUi
@using CYQ.Data.Table
@{
    //系统参数
    Layout = "../../../master/v2/master.detail.cshtml";
    MDataRow curGlobalUserLogin = ViewBag.GlobalUserLogin ?? new MDataRow();
    String curGlobalUserCode = ViewBag.GlobalUserCode ?? "";
    String curGlobalModuleCode = ViewBag.GlobalModuleCode ?? "";
    MDataTable curGlobalUserPermission = ViewBag.GlobalUserPermission ?? new MDataTable();
    MDataRow curGlobalModuleEntity = ViewBag.GlobalModuleEntity ?? new MDataRow();
    String curGlobalAdminResPath = ViewBag.GlobalAdminResPath ?? "";

    //当前业务
    String curDoCmd = ViewBag.CurrentCmd;
    String curController = "/cms/info";
    MDataRow curDrMainEntity = ViewBag.DrMainEntity ?? new MDataRow();

    MDataTable curDtAllTemplate = ViewBag.DtAllTemplate ?? new MDataTable();
    
}

@section MainHeader
{
    <script src="@curGlobalAdminResPath/ueditor/ueditor.config.js"></script>
    <script src="@curGlobalAdminResPath/ueditor/ueditor.all.min.js"></script>

}

@section FormBody
{

    @using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.Row }))
    {
        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "标题" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdInput(new LayUiInputAttr() { Id = "infotitle", Val = curDrMainEntity.Get("infotitle", ""), VerifyName = "required" })
                }
            }
        }
        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "子标题" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdInput(new LayUiInputAttr() { Id = "subtitle", Val = curDrMainEntity.Get("subtitle", ""), VerifyName = "required" })
                }
            }
        }

        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "排序值" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdInput(new LayUiInputAttr() { Id = "infoorder", Val = curDrMainEntity.Get("infoorder", "") })
                }
            }
        }
        
     

        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "小图" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputInline }))
                {
                   @Html.LayUiStdInput(new LayUiInputAttr() { Id = "smallimage", Val = curDrMainEntity.Get("smallimage", "") })
                }
                @Html.LayUiStdButton(new LayUiButtonAttr() { Id = "btnUploadSmallImage", Caption = "上传" })
            }
        }

        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md12" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem}))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr(){Caption = "摘要"})
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdUEditor(new LayUiStdUEditorAttr() { Id = "abstract", Val = curDrMainEntity.Get("abstract", "") })
                }
            }
        }      
        
        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md12" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem}))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr(){Caption = "信息内容"})
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdUEditor(new LayUiStdUEditorAttr() { Id = "infocontent", Val = curDrMainEntity.Get("infocontent", "") })
                }
            }
        }

        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "网页关键字" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdInput(new LayUiInputAttr() { Id = "metakeywords", Val = curDrMainEntity.Get("metakeywords", "") })
                }
            }
        }

        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "网页描述" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdInput(new LayUiInputAttr() { Id = "metadescription", Val = curDrMainEntity.Get("metadescription", "") })
                }
            }
        }



        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "是否重定向" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdSelect(new LayUiSelectAttr() { Id = "isredirect", Texts = "否|是", Values = "0|1", Val = curDrMainEntity.Get("isredirect", "") })
                }
            }
        }

        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "重定向地址" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdInput(new LayUiInputAttr() { Id = "redirecturl", Val = curDrMainEntity.Get("redirecturl", "") })
                }
            }
        }

        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "作者" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdInput(new LayUiInputAttr() { Id = "author", Val = curDrMainEntity.Get("author", "") })
                }
            }
        }

        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "编辑" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdInput(new LayUiInputAttr() { Id = "editor", Val = curDrMainEntity.Get("editor", "") })
                }
            }
        }

        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "标签" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdInput(new LayUiInputAttr() { Id = "tagnames", Val = curDrMainEntity.Get("tagnames", "") })
                }
            }
        }

        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "来源" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdInput(new LayUiInputAttr() { Id = "fromname", Val = curDrMainEntity.Get("fromname", "") })
                }
            }
        }

        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "来源地址" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdInput(new LayUiInputAttr() { Id = "fromurl", Val = curDrMainEntity.Get("fromurl", "") })
                }
            }
        }


        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "模板" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdSelect(new LayUiSelectAttr() { Id = "tpldetailcode", DataType = "db", Val = curDrMainEntity.Get("tpldetailcode", ""), DtSource = curDtAllTemplate, TextFieldName = "tplname", ValueFieldName = "tplcode" })
                }
            }
        }

        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "是否热点" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdSelect(new LayUiSelectAttr() { Id = "ishot", Texts = "否|是", Values = "0|1", Val = curDrMainEntity.Get("ishot", "") })
                }
            }
        }

        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "是否推荐" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdSelect(new LayUiSelectAttr() { Id = "isintroduce", Texts = "否|是", Values = "0|1", Val = curDrMainEntity.Get("isintroduce", "") })
                }
            }
        }
        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "创建时间" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdInput(new LayUiInputAttr() { Id = "createdatetime", Val = curDrMainEntity.Get("createdatetime", ""), VerifyName = "required" })
                }
            }
        }
        
        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "ID" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdInput(new LayUiInputAttr() { Id = "infoid", Val = curDrMainEntity.Get("infoid", ""),IsReadOnly = true })
                }
            }
        }

        using (Html.LayUiStdContainer(new LayUiContainerAttr() { ClassName = "layui-col-xs12 layui-col-md6" }))
        {
            using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.FormItem }))
            {
                @Html.LayUiStdLabel(new LayUiLabelAttr() { Caption = "编码" })
                using (Html.LayUiStdContainer(new LayUiContainerAttr() { LayUiContainerType = LayUiContainerType.InputBlock }))
                {
                   @Html.LayUiStdInput(new LayUiInputAttr() { Id = "infocode", Val = curDrMainEntity.Get("infocode", ""), IsReadOnly = true })
                }
            }
        }
                
        
        @Html.ExHidden("channelcode",curDrMainEntity.Get("channelcode",""))
}

}
@section FormButton
{
    @Html.LayUiStdButtonPerssionSubmit(curGlobalUserPermission, "save")
    @Html.LayUiStdButton(new LayUiButtonAttr()
                         {
                             Id = "btnClose", Caption = "关闭" ,
                             LayUiButtonSize = LayUiButtonSize.Sm,
                             LayUiButtonTheme = LayUiButtonTheme.Normal
                         })
}
@section MainBottom
{
    <script>

        layui.config({
            base: '@curGlobalAdminResPath/layuiadmin/lib/' //静态资源所在路径
        }).use(['layer', 'form', 'adfCommon','upload'], function () {
            var layer = layui.layer,
                form = layui.form,
                upload = layui.upload,
                adfCommon = layui.adfCommon;

            $("#btnClose").hide();

            //自定义验证
            form.verify({
                
            });

            //上传小图
            adfCommon.uploadImage("#btnUploadSmallImage", upload, function (retData) {
                if (retData.hasOwnProperty("ServerRelativeFileName")) {
                    $("#smallimage").val(retData.ServerRelativeFileName);
                } else {
                    adfCommon.alert("图片上传失败");
                }
            });
 

            //提交表单
            form.on('submit(btnSubmit)', function (obj) {
                var sUrl = "@curController/execute?docmd=@curDoCmd";
                var param = obj.field;
                param.infocontent = UE.getEditor('infocontent').getContent();
                param.abstract = UE.getEditor('abstract').getContent();
                
                adfCommon.ajaxSyncPost(sUrl, param, function (retData) {
                    adfCommon.msgDo(retData.RetValue, function () {
                        if (retData.RetStatus == 100 || retData.RetStatus == 101) {
                            //刷新父级数据
                            parent.globalData = retData.RetStatus;
                            //关闭当前窗口
                            adfCommon.dlgClose();
                        }
                    });
                }, function () {
                    adfCommon.alert("网络存在异常,请重试");
                });
            });

            $("#btnClose").click(function () {
                adfCommon.dlgClose();
            });

            
        });
    </script>
}
